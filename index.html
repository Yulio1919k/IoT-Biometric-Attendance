<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sistema de Asistencia</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="header">
    <div class="logo">
      <span class="logo-icon">游녡</span>
      <span>Sistema de Asistencia</span>
    </div>
    <div class="status-pills">
      <div class="pill success" id="status-esp32">
        <span class="dot"></span>
        <span id="esp32-status">ESP32</span>
      </div>
      <div class="pill success" id="status-sensor">
        <span class="dot"></span>
        <span id="sensor-status">Sensor</span>
      </div>
      <div class="pill warning" id="status-rtc">
        <span class="dot"></span>
        <span id="rtc-status">RTC</span>
      </div>
    </div>
  </div>

  <nav class="nav">
    <button class="nav-btn active" data-tab="asistencia">Registrar Asistencia</button>
    <button class="nav-btn" data-tab="registro">Nuevo Usuario</button>
    <button class="nav-btn" data-tab="usuarios">Usuarios</button>
    <button class="nav-btn" data-tab="reportes">Reportes</button>
  </nav>

  <main class="main">
    <section id="asistencia" class="section active">
      <div class="card">
        <div class="scanner">
          <div class="scanner-icon">游녡</div>
          <div class="scanner-text" id="attendance-status">
            Esperando huella para asistencia...
          </div>
          <div class="scanner-subtext">
            El sistema registrar치 tu asistencia autom치ticamente
          </div>
        </div>
        <div class="last-record" id="last-record">
          <h3>칔ltimo Registro</h3>
          <div class="record-info">
            <div class="record-row">
              <span class="record-label">Usuario:</span>
              <span class="record-value" id="last-user">---</span>
            </div>
            <div class="record-row">
              <span class="record-label">Fecha y Hora:</span>
              <span class="record-value" id="last-time">---</span>
            </div>
            <div class="record-row">
              <span class="record-label">Tipo:</span>
              <span class="record-value" id="last-type">---</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="registro" class="section">
      <div class="card">
        <h2 class="card-title">Registrar Nuevo Usuario</h2>
        <div class="form-group">
          <label class="form-label">ID Autom치tico</label>
          <input id="fingerprintId" class="form-input" type="text" readonly placeholder="Se generar치 autom치ticamente">
          <div class="form-hint">El ID se asigna autom치ticamente al capturar la huella</div>
        </div>
        <div class="form-group">
          <label class="form-label">Nombre Completo</label>
          <input id="userName" class="form-input" type="text" placeholder="Ej: Juan P칠rez Gonz치lez">
          <div id="name-feedback" class="input-feedback"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Cargo</label>
          <select id="userRole" class="form-select">
            <option value="Estudiante">Estudiante</option>
            <option value="Profesor">Profesor</option>
            <option value="Administrativo">Administrativo</option>
          </select>
        </div>
        <div class="scanner">
          <div class="scanner-icon">游녡</div>
          <div class="scanner-text" id="fingerprint-status">Esperando huella...</div>
          <div id="fingerprint-steps" style="display:none;margin-top:10px;color:#28a745;font-weight:600">
            Primera lectura completada<br>
            <span style="color:#ffc107">Retire y vuelva a colocar el dedo</span>
          </div>
        </div>
        <div class="btn-group" style="margin-top:20px">
          <button id="captureBtn" class="btn btn-primary">Capturar Huella</button>
          <button id="registerBtn" class="btn btn-success" style="display:none">Guardar Usuario</button>
        </div>
      </div>
    </section>

    <section id="usuarios" class="section">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px">
          <h2 class="card-title" style="margin:0">Gesti칩n de Usuarios</h2>
          <div class="btn-group">
            <button class="btn btn-success" id="exportExcelBtn">Excel</button>
            <button class="btn btn-primary" id="exportJsonBtn">JSON</button>
          </div>
        </div>
        <div id="usersList">
          <p style="text-align:center;color:#6c757d;padding:32px">Cargando usuarios...</p>
        </div>
      </div>
    </section>

    <section id="reportes" class="section">
      <div class="stats">
        <div class="stat-box">
          <div class="stat-number" id="stat-total">0</div>
          <div class="stat-label">Total Registros</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="stat-today">0</div>
          <div class="stat-label">Registros Hoy</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="stat-users">0</div>
          <div class="stat-label">Usuarios Activos</div>
        </div>
      </div>
      <div class="table-wrapper">
        <div class="table-controls">
          <input type="date" id="filter-date" class="form-input" style="max-width:180px">
          <select id="filter-user" class="form-select" style="max-width:180px">
            <option value="">Todos los usuarios</option>
          </select>

          <button class="btn btn-secondary" id="clearFiltersBtn">Limpiar</button>
          <!-- 游릭 NUEVO BOT칍N EXCEL -->
          <button class="btn btn-success" onclick="Database.exportXLSX()">
            Exportar Excel (.xlsx)
          </button>
          <!-- CSV (opcional) -->
          <button class="btn btn-primary" id="exportCsvBtn">
            Exportar CSV
          </button>
        </div>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Fecha</th>
              <th>Hora</th>
              <th>Cargo</th>
            </tr>
          </thead>
          <tbody id="attendance-table">
            <tr><td colspan="5" style="text-align:center;padding:32px;color:#6c757d">Cargando datos...</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Editar Usuario</h3>
        <button class="modal-close" id="closeModalBtn">&times;</button>
      </div>
      <div class="form-group">
        <label class="form-label">ID</label>
        <input id="edit-user-id" class="form-input" type="text" readonly>
      </div>
      <div class="form-group">
        <label class="form-label">Nombre Completo</label>
        <input id="edit-user-name" class="form-input" type="text">
      </div>
      <div class="form-group">
        <label class="form-label">Cargo</label>
        <select id="edit-user-role" class="form-select">
          <option value="Estudiante">Estudiante</option>
          <option value="Profesor">Profesor</option>
          <option value="Administrativo">Administrativo</option>
        </select>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" id="saveEditBtn">Guardar</button>
        <button class="btn btn-secondary" id="cancelEditBtn">Cancelar</button>
      </div>
    </div>
  </div>

  <div id="notification" class="notification">
    <p id="notification-message"></p>
  </div>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="scripts.js"></script>
</body>
</html>